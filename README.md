# Slack-Project-Sync-Agent
Slack Project Sync Agent is an automation bot that connects Slack with project management tools like Jira and GitLab. It syncs issues, creates and updates tasks, processes interactive Slack actions, and manages repository access (granting and removing permissions). It also leverages Retrieval-Augmented Generation (RAG) to provide project-relevant information directly within Slack, helping teams stay informed and streamline collaboration and workflow management.

---
## Project Structure
```
Slack-Project-Sync-Agent 
│  
├── Jira Integration  
│   ├── eluna Jira → Slack Sync  
│   └── eluna - Slack Jira Issue Formatter  
│  
├── GitLab Integration  
│   ├── eluna - GitLab Labels  
│   └── eluna - GitLab Issue Formatter  
│  
└── Agent  
    ├── eluna - Slack Buttons Handler  
    └── eluna - main 
---
```
---
## Agent
This folder contains the core n8n workflows that power the **eLuna** Slack-based AI agent. The agent listens to messages in Slack, classifies and processes tasks, coordinates human approvals, and interacts with project management tools (Jira & GitLab) — all from within a Slack interface.
---

## Architecture Overview
```
User sends a message in Slack
            │
            ▼
     AI classifies intent
            │
     ┌──────┴──────┐
     │             │
 Question?      Task request?
     │             │
     ▼             ▼
 Query knowledge  Draft ticket & ask
 base → reply     for human approval
 in Slack              │
                  ┌────┴────┐
                  │         │
              Approved   Feedback
                  │         │
                  ▼         ▼
           Create ticket  Revise &
           in Jira or     repost for
           GitLab         approval. loops 
                          untill Approved
```

## Workflows

### 1. `eluna - main`

The primary orchestration workflow. It handles the full lifecycle of a Slack-triggered event — from message ingestion through AI processing, human approval, and downstream task execution.

**Trigger:** Slack event (message or thread reply)

**Key stages:**

- **Event routing** — Incoming Slack events are classified by type (new message vs. thread reply). Thread replies can resume a paused workflow waiting on human input.
- **Text preprocessing** — Raw Slack message text is cleaned and normalized before being passed to the AI layer.
- **Task classification** — An OpenAI-powered classifier determines whether the message represents a task creation request or a general query.
- **RAG query** — For general queries, the agent queries a RAG (Retrieval-Augmented Generation) database and posts the result back to Slack.
- **AI Agent** — For task-related requests, an LangChain AI Agent (backed by OpenAI) processes the intent and prepares structured output.
- **Human approval** — Before any action is taken, a Slack message with interactive approval buttons is posted to the relevant channel. The workflow pauses (via a Wait node) until the user responds.
- **Approval routing** — Based on the user's response (approved/rejected/feedback), the workflow either proceeds or loops back for revision using a Feedback Agent.
- **Task execution** — Approved tasks are routed to either the GitLab or Jira sub-workflow for execution, depending on the target platform.

---

### 2. `eluna - Slack Buttons Handler`

A webhook-driven workflow that handles all interactive button clicks made by users inside Slack messages generated by the agent.

**Trigger:** Webhook (`POST /LC-gitlab`) — called when a user clicks a button in a Slack message

**Key stages:**

- **Block ID routing** — Incoming payloads are inspected to determine which Slack block triggered the interaction (e.g., `workflow_controls`, `approval_buttons`, or `jira_controls`).
- **Platform routing** — Actions are routed to either the **Feedback & Approval**, **Jira** or **GitLab** handler branch based on the payload source.
- **Jira actions:**
  - Update issue **assignee**, **due date**, **priority**, or **status/transition**
  - Fetch updated issue details and reassemble the Slack message with refreshed interactive buttons
  - Post ephemeral error messages to the user if an action fails
- **GitLab actions:**
  - Update issue **assignee**, **due date**, **priority** (via labels), or **workflow labels**
  - Add/remove priority and workflow labels atomically
  - Fetch updated issue details and rebuild the Slack message
  - Post ephemeral error messages on failure
- **Feedback & Approval** — For approval-type buttons, the handler resumes the paused main workflow by calling its wait-resume webhook with the user's decision and context.
- **Slack message update** — After every successful action, the original Slack message is updated in-place to reflect the latest issue state.

---

## Dependencies

| Service | Usage |
|---|---|
| Slack | Trigger, messaging, interactive buttons |
| OpenAI | Task classification, AI Agent, feedback generation |
| Jira | Issue creation, updates (assignee, priority, status, due date) |
| GitLab | Issue creation, updates (assignee, labels, due date) |
| RAG Database | Knowledge base queries (via HTTP) |
| n8n DataTable | Storing thread timestamps and URLs for workflow resumption |


